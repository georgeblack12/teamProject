<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>address</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.3"></script>
</head>
<body style="background:#CBE1FF">
<div style="width:730px;margin:auto;">
  要查询的地址：<input id="text_" type="text" value="Northumberland" style="margin-right:100px;" />
  <!--		查询结果(经纬度)： <input id="result_" type="text" />-->
  <input type="button" value="确定" onclick="searchByStationName();" />
  <div id="container" style="position: absolute;margin-top:30px;width: 730px;height: 590px;top: 50;border: 1px solid gray;overflow:hidd">
  </div>
</div>
</body>
<script type="text/javascript">
  var map = new BMap.Map("container");
  map.centerAndZoom("Northumberland", 10);
  map.enableScrollWheelZoom(); //启用滚轮放大缩小，默认禁用
  map.enableContinuousZoom(); //启用地图惯性拖拽，默认禁用
  map.addControl(new BMap.NavigationControl()); //添加默认缩放平移控件
  map.addControl(new BMap.OverviewMapControl()); //添加默认缩略地图控件
  map.addControl(new BMap.OverviewMapControl({
    isOpen: true,
    anchor: BMAP_ANCHOR_BOTTOM_RIGHT
  })); //右下角，打开
  var localSearch = new BMap.LocalSearch(map);
  localSearch.enableAutoViewport(); //允许自动调节窗体大小
  function searchByStationName() {

    map.clearOverlays(); //清空原来的标注
    var keyword = document.getElementById("text_").value;
    localSearch.setSearchCompleteCallback(function(searchResult) {
      var poi = searchResult.getPoi(0);
      //document.getElementById("result_").value = poi.point.lng + "," + poi.point.lat;
      map.centerAndZoom(poi.point, 13);
      var marker = new BMap.Marker(new BMap.Point(poi.point.lng, poi.point.lat)); // 创建标注，为要查询的地方对应的经纬度
      map.addOverlay(marker);
      var content = document.getElementById("text_").value + "<br/><br/>经度：" + poi.point.lng + "<br/>纬度：" + poi.point.lat;
      var infoWindow = new BMap.InfoWindow("<p style='font-size:14px;'>" + content + "</p>");
      marker.addEventListener("click", function() {
        this.openInfoWindow(infoWindow);
      });
      // marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
      //获取选择地址的经纬度
      var lat1 = 43.929181;	//冰激凌店铺纬度
      var lng1 = -78.110828;	//冰激凌店铺经度
      var lat2 = poi.point.lat;	//用户纬度
      var lng2 = poi.point.lng;	//用户经度
      var radLat1 = lat1*Math.PI / 180.0;
      var radLat2 = lat2*Math.PI / 180.0;
      var a = radLat1 - radLat2;
      var b = lng1*Math.PI / 180.0 - lng2*Math.PI / 180.0;
      var s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(a/2),2) + Math.cos(radLat1)*Math.cos(radLat2)*Math.pow(Math.sin(b/2),2)));
      s = s *6378.137 ;// EARTH_RADIUS;
      s = Math.round(s * 10000) / 10000;
      if(s > 5000){
        alert("超出配送范围，请重新选择地址");

      }else{
        alert("可配送");
      }
      window.history.go(-1);
    });
    localSearch.search(keyword);

  }
</script>
</html>
